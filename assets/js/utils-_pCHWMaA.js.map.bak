{"version":3,"file":"utils-_pCHWMaA.js","sources":["../../../src/ts/utils.ts"],"sourcesContent":["// NEXUTHA - Utility Functions\n\nimport type { \n  Language, \n  Theme, \n  ChatMessage, \n  ThrottledFunction, \n  DebouncedFunction, \n  PerformanceMetrics,\n  AnalyticsEvent,\n  ErrorLog\n} from './types';\n\n/**\n * Throttle function execution\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T, \n  limit: number\n): ThrottledFunction<T> {\n  let inThrottle: boolean;\n  \n  const throttledFunc = ((...args: Parameters<T>) => {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => inThrottle = false, limit);\n    }\n  }) as ThrottledFunction<T>;\n\n  throttledFunc.cancel = () => {\n    inThrottle = false;\n  };\n\n  return throttledFunc;\n}\n\n/**\n * Debounce function execution\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T, \n  delay: number\n): DebouncedFunction<T> {\n  let timeoutId: number | undefined;\n  let lastArgs: Parameters<T> | undefined;\n\n  const debouncedFunc = ((...args: Parameters<T>) => {\n    lastArgs = args;\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = window.setTimeout(() => {\n      func.apply(this, args);\n      timeoutId = undefined;\n    }, delay);\n  }) as DebouncedFunction<T>;\n\n  debouncedFunc.cancel = () => {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n      timeoutId = undefined;\n    }\n  };\n\n  debouncedFunc.flush = () => {\n    if (timeoutId !== undefined && lastArgs) {\n      debouncedFunc.cancel();\n      return func.apply(this, lastArgs);\n    }\n  };\n\n  return debouncedFunc;\n}\n\n/**\n * Generate unique ID\n */\nexport function generateId(prefix: string = ''): string {\n  const timestamp = Date.now().toString(36);\n  const randomStr = Math.random().toString(36).substring(2);\n  return `${prefix}${timestamp}${randomStr}`;\n}\n\n/**\n * Format date to readable string\n */\nexport function formatDate(date: Date, language: Language = 'ja'): string {\n  const options: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  };\n\n  const locale = language === 'ja' ? 'ja-JP' : 'en-US';\n  return new Intl.DateTimeFormat(locale, options).format(date);\n}\n\n/**\n * Animate counting numbers\n */\nexport function animateCounter(\n  element: HTMLElement,\n  target: number,\n  duration: number = 2000,\n  callback?: () => void\n): void {\n  const start = 0;\n  const startTime = performance.now();\n\n  function updateCounter(currentTime: number) {\n    const elapsed = currentTime - startTime;\n    const progress = Math.min(elapsed / duration, 1);\n    \n    // Easing function (ease out)\n    const easeOut = 1 - Math.pow(1 - progress, 3);\n    const current = Math.round(start + (target - start) * easeOut);\n    \n    element.textContent = current.toLocaleString();\n\n    if (progress < 1) {\n      requestAnimationFrame(updateCounter);\n    } else if (callback) {\n      callback();\n    }\n  }\n\n  requestAnimationFrame(updateCounter);\n}\n\n/**\n * Smooth scroll to element\n */\nexport function scrollToElement(\n  target: string | HTMLElement,\n  offset: number = 0,\n  behavior: ScrollBehavior = 'smooth'\n): void {\n  const element = typeof target === 'string' ? document.querySelector(target) : target;\n  \n  if (!element) return;\n\n  const targetPosition = element.getBoundingClientRect().top + window.pageYOffset - offset;\n  \n  window.scrollTo({\n    top: targetPosition,\n    behavior\n  });\n}\n\n/**\n * Check if element is in viewport\n */\nexport function isInViewport(element: HTMLElement, threshold: number = 0): boolean {\n  const rect = element.getBoundingClientRect();\n  const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n  const windowWidth = window.innerWidth || document.documentElement.clientWidth;\n  \n  const vertInView = (rect.top <= windowHeight * (1 - threshold)) && \n                     ((rect.top + rect.height) >= windowHeight * threshold);\n  const horInView = (rect.left <= windowWidth * (1 - threshold)) && \n                    ((rect.left + rect.width) >= windowWidth * threshold);\n  \n  return vertInView && horInView;\n}\n\n/**\n * Local storage utilities with error handling\n */\nexport const storage = {\n  set<T>(key: string, value: T): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.warn('Failed to save to localStorage:', error);\n    }\n  },\n\n  get<T>(key: string, defaultValue?: T): T | undefined {\n    try {\n      const item = localStorage.getItem(key);\n      return item ? JSON.parse(item) : defaultValue;\n    } catch (error) {\n      console.warn('Failed to read from localStorage:', error);\n      return defaultValue;\n    }\n  },\n\n  remove(key: string): void {\n    try {\n      localStorage.removeItem(key);\n    } catch (error) {\n      console.warn('Failed to remove from localStorage:', error);\n    }\n  },\n\n  clear(): void {\n    try {\n      localStorage.clear();\n    } catch (error) {\n      console.warn('Failed to clear localStorage:', error);\n    }\n  }\n};\n\n/**\n * Validate email address\n */\nexport function isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n/**\n * Sanitize HTML string\n */\nexport function sanitizeHTML(html: string): string {\n  const div = document.createElement('div');\n  div.textContent = html;\n  return div.innerHTML;\n}\n\n/**\n * Format file size\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * Wait for specified duration\n */\nexport function wait(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Retry function with exponential backoff\n */\nexport async function retry<T>(\n  fn: () => Promise<T>,\n  maxAttempts: number = 3,\n  baseDelay: number = 1000\n): Promise<T> {\n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      if (attempt === maxAttempts) {\n        throw error;\n      }\n      \n      const delay = baseDelay * Math.pow(2, attempt - 1);\n      await wait(delay);\n    }\n  }\n  \n  throw new Error('Retry failed');\n}\n\n/**\n * Create intersection observer with callback\n */\nexport function createIntersectionObserver(\n  callback: IntersectionObserverCallback,\n  options?: IntersectionObserverInit\n): IntersectionObserver {\n  const defaultOptions: IntersectionObserverInit = {\n    threshold: 0.1,\n    rootMargin: '0px',\n    ...options\n  };\n\n  return new IntersectionObserver(callback, defaultOptions);\n}\n\n/**\n * Preload image\n */\nexport function preloadImage(src: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = src;\n  });\n}\n\n/**\n * Get device type\n */\nexport function getDeviceType(): 'mobile' | 'tablet' | 'desktop' {\n  const userAgent = navigator.userAgent.toLowerCase();\n  const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/.test(userAgent);\n  \n  if (isMobile) {\n    return window.innerWidth < 768 ? 'mobile' : 'tablet';\n  }\n  \n  return 'desktop';\n}\n\n/**\n * Check if user prefers reduced motion\n */\nexport function prefersReducedMotion(): boolean {\n  return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n}\n\n/**\n * Get browser language\n */\nexport function getBrowserLanguage(): Language {\n  const language = navigator.language.toLowerCase();\n  return language.startsWith('ja') ? 'ja' : 'en';\n}\n\n/**\n * Copy text to clipboard\n */\nexport async function copyToClipboard(text: string): Promise<boolean> {\n  try {\n    if (navigator.clipboard && window.isSecureContext) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback for older browsers\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-999999px';\n      textArea.style.top = '-999999px';\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n      const result = document.execCommand('copy');\n      textArea.remove();\n      return result;\n    }\n  } catch (error) {\n    console.error('Failed to copy text:', error);\n    return false;\n  }\n}\n\n/**\n * Performance measurement utilities\n */\nexport const performance = {\n  mark(name: string): void {\n    if ('performance' in window && window.performance.mark) {\n      window.performance.mark(name);\n    }\n  },\n\n  measure(name: string, startMark: string, endMark?: string): number | undefined {\n    if ('performance' in window && window.performance.measure) {\n      try {\n        window.performance.measure(name, startMark, endMark);\n        const entries = window.performance.getEntriesByName(name);\n        return entries[entries.length - 1]?.duration;\n      } catch (error) {\n        console.warn('Performance measurement failed:', error);\n      }\n    }\n    return undefined;\n  },\n\n  getMetrics(): PerformanceMetrics | null {\n    if (!('performance' in window)) return null;\n\n    const navigation = window.performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;\n    const paint = window.performance.getEntriesByType('paint');\n    \n    const fcp = paint.find(entry => entry.name === 'first-contentful-paint');\n    const lcp = window.performance.getEntriesByType('largest-contentful-paint').pop();\n    \n    return {\n      loadTime: navigation?.loadEventEnd - navigation?.navigationStart || 0,\n      firstContentfulPaint: fcp?.startTime || 0,\n      largestContentfulPaint: (lcp as any)?.startTime || 0,\n      cumulativeLayoutShift: 0, // Would need to be measured separately\n      firstInputDelay: 0 // Would need to be measured separately\n    };\n  }\n};\n\n/**\n * Simple event emitter\n */\nexport class EventEmitter<T extends Record<string, any> = Record<string, any>> {\n  private listeners: Map<keyof T, Set<Function>> = new Map();\n\n  on<K extends keyof T>(event: K, callback: (data: T[K]) => void): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(callback);\n  }\n\n  off<K extends keyof T>(event: K, callback: (data: T[K]) => void): void {\n    this.listeners.get(event)?.delete(callback);\n  }\n\n  emit<K extends keyof T>(event: K, data: T[K]): void {\n    this.listeners.get(event)?.forEach(callback => {\n      try {\n        callback(data);\n      } catch (error) {\n        console.error('Event listener error:', error);\n      }\n    });\n  }\n\n  removeAllListeners<K extends keyof T>(event?: K): void {\n    if (event) {\n      this.listeners.delete(event);\n    } else {\n      this.listeners.clear();\n    }\n  }\n}\n\n/**\n * Error logging utility\n */\nexport const errorLogger = {\n  log(error: ErrorLog): void {\n    // Log to console in development\n    if (process.env.NODE_ENV === 'development') {\n      console.error('[NEXUTHA Error]', error);\n    }\n\n    // Send to analytics in production\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToAnalytics(error);\n    }\n\n    // Store locally for debugging\n    this.storeLocally(error);\n  },\n\n  sendToAnalytics(error: ErrorLog): void {\n    // Implementation would depend on analytics service\n    // Example for Google Analytics\n    if (typeof gtag !== 'undefined') {\n      gtag('event', 'exception', {\n        description: error.message,\n        fatal: error.level === 'error'\n      });\n    }\n  },\n\n  storeLocally(error: ErrorLog): void {\n    try {\n      const errors = storage.get<ErrorLog[]>('nexutha_errors', []);\n      errors.push(error);\n      \n      // Keep only last 100 errors\n      if (errors.length > 100) {\n        errors.splice(0, errors.length - 100);\n      }\n      \n      storage.set('nexutha_errors', errors);\n    } catch (e) {\n      console.warn('Failed to store error locally:', e);\n    }\n  }\n};\n\n/**\n * Feature detection utilities\n */\nexport const features = {\n  supportsWebP(): boolean {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\n  },\n\n  supportsIntersectionObserver(): boolean {\n    return 'IntersectionObserver' in window;\n  },\n\n  supportsServiceWorker(): boolean {\n    return 'serviceWorker' in navigator;\n  },\n\n  supportsWebGL(): boolean {\n    try {\n      const canvas = document.createElement('canvas');\n      return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));\n    } catch (error) {\n      return false;\n    }\n  },\n\n  supportsTouchEvents(): boolean {\n    return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n  }\n};"],"names":["throttle","func","limit","inThrottle","throttledFunc","args","apply","this","setTimeout","cancel","debounce","delay","timeoutId","lastArgs","debouncedFunc","clearTimeout","window","flush","generateId","prefix","timestamp","Date","now","toString","randomStr","Math","random","substring","concat","animateCounter","element","target","duration","callback","startTime","performance","requestAnimationFrame","updateCounter","currentTime","elapsed","progress","min","easeOut","pow","current","round","textContent","toLocaleString","scrollToElement","offset","behavior","document","querySelector","targetPosition","getBoundingClientRect","top","pageYOffset","scrollTo","isInViewport","threshold","rect","windowHeight","innerHeight","documentElement","clientHeight","windowWidth","innerWidth","clientWidth","vertInView","height","horInView","left","width","storage","set","key","value","localStorage","setItem","JSON","stringify","error","get","defaultValue","item","getItem","parse","remove","removeItem","clear","createIntersectionObserver","options","defaultOptions","rootMargin","IntersectionObserver","getDeviceType","userAgent","navigator","toLowerCase","test","prefersReducedMotion","matchMedia","matches","getBrowserLanguage","language","startsWith","mark","name","measure","startMark","endMark","_a","entries","getEntriesByName","length","getMetrics","navigation","getEntriesByType","fcp","find","entry","lcp","pop","loadTime","loadEventEnd","navigationStart","firstContentfulPaint","largestContentfulPaint","cumulativeLayoutShift","firstInputDelay","EventEmitter","constructor","listeners","Map","on","event","has","Set","add","off","delete","emit","data","forEach","removeAllListeners","errorLogger","log","sendToAnalytics","storeLocally","gtag","description","message","fatal","level","errors","push","splice","e"],"mappings":"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"}